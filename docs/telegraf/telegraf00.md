---
id: telegraf00
title: Оплата в Telegram боте 
sidebar_label: Оплата в Telegram боте 
---

Платежи 2.0 — Telegram ввел оплату картами во всех чатах

В мессенджере Telegram появилась возможность принимать платежи в любом чате, включая группы и каналы. Подключить свой магазин к платформе можно самостоятельно, без согласования с Telegram.

И в этом туториале мы создадим простого бота с [Node.js](https://nodejs.org/en/) на фреймворке [Telegraf.js](https://telegraf.js.org/), который сможет принимать деньги с клиента и отправлять их на ваш счет через Сбербанк.

![Платежи 2.0](https://telegram.org/file/464001036/3/9ZnITFnkib4.283442/5dc5b1f30fa97ec631)

## Платежи 2.0

Платёжные боты существуют в Telegram с 2017 года. С их помощью можно безопасно оплачивать товары и услуги вроде доставки пиццы, не покидая приложения.

С сегодняшнего дня продавцы могут принимать платежи кредитными картами с помощью 8-ми встроенных платёжных систем в любом чате, включая группы и каналы.

На данный момент мы поддерживаем платежи из более чем 200 стран через следующих платежных систем:

![payments](/img/telegraf/payments.jpg)

Telegram не обрабатывает платежи от пользователей и вместо этого полагается на разных поставщиков платежей по всему миру. Именно провайдеры платежей обрабатывают и хранят всю конфиденциальную информацию, например данные кредитной карты. Ни Telegram, ни разработчики ботов не имеют к нему доступа.

Для оплаты можно использовать любое приложение – в том числе Telegram для компьютеров. Покупатель также может оставить чаевые, чтобы поддержать любимого автора, кафе или магазин.


## Создаём бота в Telegram

Бот в Telegram создается при помощи другого бота под названием [@BotFather](http://telegram.me/BotFather). Отправляем ему команду `/newbot`, выбираем имя, которое будет отображаться в списке контактов, и адрес. Например, `Оплата в Telegram боте` с адресом `sber_pay_test_bot`.

![newBot](/img/telegraf/newBot.jpg)

Если адрес не занят, а имя введено правильно, BotFather пришлет в ответ сообщение с токеном — «ключом» для доступа к созданному боту. 

:::caution Внимание
Его нужно сохранить и никому не показывать.
:::

## Создаем проект Node.js

Далее создадим новый проект. Создаем папку. 

Вводим в консоле:

```bash
mkdir sber_pay_test_bot && cd sber_pay_test_bot
```
Затем:

```bash npm2yarn
npm init 
```

Программа задаёт вам разные вопросы и создает `package.json`, который определяет настройки проекта, зависимости, скрипты, название и прочее. Для примера можно везде нажать `enter`

и добавим файл `index.js` в котором будет разрабатываться наш бот. 

```bash
touch index.js    
```

## Telegraf.js

Cтавим telegraf.js — это один из популярных фреймворков для создания телеграмм бота. 

```bash npm2yarn
npm install telegraf 
```

Ставим библиотеку `dotenv` - это модуль, который загружает переменные среды из файла `.env` в `process.env.`, а также заодно поставим `nodemon` - инструмент, который помогает разрабатывать приложения на основе node.js путем автоматического перезапуска приложения `node` при обнаружении изменений файлов в каталоге.

```bash npm2yarn
npm install dotenv nodemon
```

Добавляем скрипт запуска в `package.json`

```json
"scripts": {
    "start": "nodemon index"
}
```

Смотрим документацию телеграфа, копируем в наш проект первоначальную настройку бота.

```js
const { Telegraf } = require('telegraf')
require('dotenv').config()

const bot = new Telegraf(process.env.BOT_TOKEN) //сюда помещается токен, который дал botFather

bot.start((ctx) => ctx.reply('Welcome')) //ответ бота на команду /start
bot.help((ctx) => ctx.reply('Send me a sticker')) //ответ бота на команду /help
bot.on('sticker', (ctx) => ctx.reply('')) //bot.on это обработчик введенного юзером сообщения, в данном случае он отслеживает стикер, можно использовать обработчик текста или голосового сообщения
bot.hears('hi', (ctx) => ctx.reply('Hey there')) // bot.hears это обработчик конкретного текста, данном случае это - "hi"
bot.launch() // запуск бота
```

Создаем файл `.env` куда в переменую `BOT_TOKEN` кладем токен, который ранее нам выдал [@BotFather](http://telegram.me/BotFather) 

```js
BOT_TOKEN='сюда'
```

Запускаем бот командой

```bash npm2yarn
npm run start
```

Проверяем работу бота

![chekBot](/img/telegraf/checkBot.jpg)


## Получаем PROVIDER_TOKEN от @SberbankPaymentBot

Для получения `PROVIDER_TOKEN` вам необходимо получить `merchantLogin` в Сбербанке. Для этого необходимо подключить [услугу интерент-эквайринг в Сбербанке](https://www.sberbank.ru/ru/s_m_business/bankingservice/acquiring_total).

После того как вы его получили переходим в [@BotFather](http://telegram.me/BotFather) и вызываем команду `/mybots`, где выбераем вашего бота.

Далее `Payments`

![Payments](/img/telegraf/selectPayments.jpg)

Где выбераем Сбербанк 

![Payments](/img/telegraf/selectSber.jpg)

Выбераем `Connect Сбербанк Live`

![Payments](/img/telegraf/SberLive.jpg)

После этого вас перекинет на `@SberbankPaymentBot`, где нужно ввести ваш `merchantLogin`, который неодходимо вводить без всяких префиксов `-api` или `-operator`. Например так: `P71XXXXXXX21`. Из-за того что я этого не знал, у меня ушло на переписку с техподдержкой Сбербанка неделя времени. 

![SberbankPaymentBot](/img/telegraf/SberPaymentBot.jpg)

После [@BotFather](http://telegram.me/BotFather) выдаст вам токен, который нужно вставить в переменную `PROVIDER_TOKEN` файла `.env`

![SberbankPaymentBot](/img/telegraf/token.jpg)

# 
